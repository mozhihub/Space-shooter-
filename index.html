<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Vanguard: Pro Audio</title>
    <style>
        :root { --neon: #00f2ff; --gold: #ffd700; --hp: #ff2d55; --boss: #a020f0; --bg: #00050f; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; touch-action: none; }
        canvas { display: block; filter: saturate(1.5) contrast(1.1); background: #000; }

        #hud { position: absolute; inset: 0; pointer-events: none; z-index: 10; padding: 15px; display: none; }
        .top-row { display: flex; justify-content: space-between; pointer-events: auto; }
        #menu-btn { font-size: 35px; cursor: pointer; color: var(--neon); text-shadow: 0 0 10px var(--neon); }
        
        .bar-container { width: 120px; height: 8px; background: #111; border: 1px solid #333; border-radius: 4px; margin-top: 5px; overflow: hidden; }
        #hp-fill { width: 100%; height: 100%; background: var(--hp); transition: 0.2s; }
        #sh-fill { width: 0%; height: 100%; background: var(--gold); transition: 0.2s; }

        #menu-box { position: absolute; top: 65px; right: 15px; background: rgba(0,0,0,0.95); border: 2px solid var(--neon); display: none; flex-direction: column; pointer-events: auto; border-radius: 12px; z-index: 100; }
        #menu-box button { background: none; border: none; color: white; padding: 15px 20px; border-bottom: 1px solid #222; cursor: pointer; text-align: left; font-weight: bold; }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 200; display: none; flex-direction: column; align-items: center; padding: 25px; pointer-events: auto; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 400px; margin-top: 15px; }
        .card { background: #0a0a0a; border: 1px solid #222; padding: 15px; border-radius: 10px; text-align: center; }
        .card button { width: 100%; margin-top: 8px; background: var(--neon); border: none; padding: 8px; border-radius: 5px; font-weight: bold; cursor: pointer; color: #000; }

        #boss-ui { position: absolute; top: 80px; left: 50%; transform: translateX(-50%); width: 250px; display: none; text-align: center; }
        .boss-bar { height: 8px; background: #000; border: 1px solid var(--boss); border-radius: 4px; overflow: hidden; }
        #boss-fill { width: 100%; height: 100%; background: var(--boss); }

        #start-screen { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 500; cursor: pointer; }
        .play-btn { background: var(--neon); color: #000; padding: 15px 40px; border-radius: 30px; font-weight: bold; font-size: 20px; margin-top: 20px; box-shadow: 0 0 20px var(--neon); }
        
        .mute-btn { background: var(--hp); color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 20px; width: 200px; }
        .mute-btn.on { background: #4caf50; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1 style="color:var(--neon); font-size: 40px; margin:0;">NEON BLASTER</h1>
    <div class="play-btn" onclick="initGame()">PLAY NOW</div>
</div>

<div id="hud">
    <div class="top-row">
        <div>
            <div style="color:var(--gold); font-size: 18px; font-weight: bold;">ü™ô <span id="gold-val">0</span></div>
            <div class="bar-container"><div id="hp-fill"></div></div>
            <div class="bar-container"><div id="sh-fill"></div></div>
        </div>
        <div id="menu-btn" onclick="toggleMenu()">‚ãÆ</div>
    </div>
    <div id="boss-ui">
        <div class="boss-bar"><div id="boss-fill"></div></div>
    </div>
</div>

<div id="menu-box">
    <button onclick="openTab('gun-shop')">üî´ GUN SHOP</button>
    <button onclick="openTab('ship-shop')">üöÄ SHIPS</button>
    <button onclick="openTab('shield-shop')">üõ°Ô∏è SHIELDS</button>
    <button onclick="openTab('settings')">‚öôÔ∏è SETTINGS</button>
    <button onclick="closeAll()">RESUME</button>
</div>

<div id="gun-shop" class="overlay">
    <h2>GUNS</h2><div class="grid" id="gun-grid"></div>
    <button onclick="closeAll()" style="margin-top:20px; color:#fff;">BACK</button>
</div>

<div id="ship-shop" class="overlay">
    <h2>SHUTTLES</h2><div class="grid" id="ship-grid"></div>
    <button onclick="closeAll()" style="margin-top:20px; color:#fff;">BACK</button>
</div>

<div id="shield-shop" class="overlay">
    <h2>SHIELDS</h2><div class="grid" id="shield-grid"></div>
    <button onclick="closeAll()" style="margin-top:20px; color:#fff;">BACK</button>
</div>

<div id="settings" class="overlay">
    <h2>SETTINGS</h2>
    <button id="sound-toggle-btn" class="mute-btn on" onclick="toggleSound()">SOUND: ON</button>
    <p style="font-size: 12px; color: #666; margin-top: 10px;">Music & SFX will be muted</p>
    <button onclick="closeAll()" style="margin-top:20px; color:#fff;">BACK</button>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth; canvas.height = window.innerHeight;

let gold = 0, gunLv = 1, shipLv = 1, shieldLv = 0, hp = 100, maxHp = 100;
let curSh = 0, maxSh = 0, active = false, pX = canvas.width/2;
let bullets = [], enemies = [], boss = null, lastFire = 0;
let soundEnabled = true;
let audioCtx;

function initGame() {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('hud').style.display = 'block';
    active = true; renderAll(); requestAnimationFrame(loop);
}

function toggleSound() {
    soundEnabled = !soundEnabled;
    const btn = document.getElementById('sound-toggle-btn');
    btn.innerText = `SOUND: ${soundEnabled ? 'ON' : 'OFF'}`;
    btn.className = `mute-btn ${soundEnabled ? 'on' : ''}`;
}

function playSfx(f, t, d) {
    if(!audioCtx || !soundEnabled) return;
    let o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type = t; o.frequency.value = f;
    g.gain.setValueAtTime(0.05, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + d);
}

function toggleMenu() { let m=document.getElementById('menu-box'); m.style.display=(m.style.display==='flex')?'none':'flex'; }
function openTab(id) { active=false; document.getElementById(id).style.display='flex'; toggleMenu(); }
function closeAll() { active=true; document.querySelectorAll('.overlay').forEach(e=>e.style.display='none'); }

function renderAll() {
    let gH='', sH='', shH='';
    for(let i=1; i<=20; i++) gH+=`<div class="card">G-v${i}<button onclick="buy('g',${i},${i*500})">ü™ô ${i*500}</button></div>`;
    for(let i=1; i<=50; i++) sH+=`<div class="card">S-v${i}<button onclick="buy('s',${i},${i*1000})">ü™ô ${i*1000}</button></div>`;
    for(let i=1; i<=10; i++) shH+=`<div class="card">SH-Lv${i}<button onclick="buy('sh',${i},${i*2000})">ü™ô ${i*2000}</button></div>`;
    document.getElementById('gun-grid').innerHTML=gH;
    document.getElementById('ship-grid').innerHTML=sH;
    document.getElementById('shield-grid').innerHTML=shH;
}

function buy(t,l,c) {
    if(gold>=c) {
        gold-=c; 
        if(t==='g') gunLv=l; 
        else if(t==='s'){ shipLv=l; maxHp=100+(l*15); hp=maxHp; }
        else if(t==='sh'){ shieldLv=l; maxSh=l*30; curSh=maxSh; }
        updateUI(); playSfx(600,'sine',0.1);
    }
}

function updateUI() {
    document.getElementById('gold-val').innerText=gold;
    document.getElementById('hp-fill').style.width=(hp/maxHp*100)+"%";
    document.getElementById('sh-fill').style.width=maxSh>0?(curSh/maxSh*100)+"%":"0%";
}

function loop(t) {
    if(!active) return requestAnimationFrame(loop);
    ctx.fillStyle='rgba(0,5,15,0.4)'; ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.save(); ctx.translate(pX, canvas.height-80);
    ctx.strokeStyle=`hsl(${shipLv*25},100%,60%)`; ctx.lineWidth=3;
    ctx.beginPath(); ctx.moveTo(0,-30); ctx.lineTo(20,15); ctx.lineTo(-20,15); ctx.closePath(); ctx.stroke();
    if(curSh>0){ ctx.beginPath(); ctx.arc(0,0,40,0,Math.PI*2); ctx.strokeStyle="#ffd700"; ctx.stroke(); }
    ctx.restore();

    let rate = Math.max(60, 300-(gunLv*12));
    if(t-lastFire > rate) {
        bullets.push({x:pX, y:canvas.height-100, vy:-15});
        if(gunLv>5){ bullets.push({x:pX-20, y:canvas.height-80, vy:-12}); bullets.push({x:pX+20, y:canvas.height-80, vy:-12}); }
        playSfx(200+(gunLv*5),'square',0.05); lastFire=t;
    }

    bullets.forEach((b,i)=>{
        b.y+=b.vy; ctx.fillStyle="#fff"; ctx.fillRect(b.x-2,b.y,4,18);
        if(b.y<0) bullets.splice(i,1);
    });

    let difficulty = Math.floor(gold/3000)+1;
    if(difficulty % 5 === 0 && !boss) {
        boss = { x: canvas.width/2, y: -100, hp: difficulty*150, m: difficulty*150, d: 2 };
        document.getElementById('boss-ui').style.display = 'block';
    }

    if(boss) {
        boss.y = Math.min(boss.y + 1, 120); boss.x += boss.d;
        if(boss.x > canvas.width-60 || boss.x < 60) boss.d *= -1;
        ctx.strokeStyle="#a020f0"; ctx.lineWidth=5; ctx.strokeRect(boss.x-50, boss.y-25, 100, 50);
        document.getElementById('boss-fill').style.width=(boss.hp/boss.m*100)+"%";
        bullets.forEach((b,bi)=>{
            if(Math.abs(b.x-boss.x)<50 && Math.abs(b.y-boss.y)<25){
                boss.hp--; bullets.splice(bi,1);
                if(boss.hp <= 0) { gold += 5000; boss = null; document.getElementById('boss-ui').style.display='none'; updateUI(); }
            }
        });
    }

    if(!boss && Math.random() < 0.04) {
        enemies.push({x: Math.random()*canvas.width, y: -50, hp: Math.max(1, Math.floor(difficulty/2)), type: difficulty%3});
    }

    enemies.forEach((e,i)=>{
        e.y += 3; ctx.strokeStyle="red"; ctx.lineWidth=2;
        if(e.type===0) ctx.strokeRect(e.x-15, e.y-15, 30, 30);
        else { ctx.beginPath(); ctx.moveTo(e.x,e.y-15); ctx.lineTo(e.x+15,e.y+15); ctx.lineTo(e.x-15,e.y+15); ctx.closePath(); ctx.stroke(); }
        bullets.forEach((b,bi)=>{
            if(Math.abs(b.x-e.x)<25 && Math.abs(b.y-e.y)<25){
                e.hp--; bullets.splice(bi,1);
                if(e.hp<=0){ enemies.splice(i,1); gold+=100; updateUI(); playSfx(150,'sawtooth',0.05); }
            }
        });
        if(Math.abs(e.x-pX)<35 && Math.abs(e.y-(canvas.height-80))<35){
            if(curSh > 0) curSh -= 10; else hp -= 20;
            enemies.splice(i,1); updateUI();
            if(hp <= 0) location.reload();
        }
    });
    requestAnimationFrame(loop);
}

const handleInput=(e)=>{ pX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX; };
window.addEventListener('mousemove', handleInput);
window.addEventListener('touchmove', handleInput, {passive: false});
</script>
</body>
</html>
